<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<script> 
			window.onload = function() {
				document.getElementById('Convert').onclick = function fun() {
					const moneyValue = document.forms['converter']['value'].value;
					const baseCurrency = document.forms['converter']['base'].value;
					const endCurrency = document.forms['converter']['end'].value;
					console.log(baseCurrency, endCurrency);
					console.log(moneyValue);
					const API = `https://api.exchangeratesapi.io/latest?symbols=${baseCurrency},${endCurrency}`;
					console.log(API)
					const xhr = new XMLHttpRequest();
					xhr.open('GET', API);
					xhr.send();
					xhr.onreadystatechange = processRequest;
					function processRequest(e) {
						if (xhr.readyState == 4 && xhr.status == 200) {
							console.log(xhr.responseText);
							const responseValue = JSON.parse(xhr.responseText);
							console.log(responseValue.rates[`${endCurrency}`]);
							let USDToGBPRate = responseValue.rates[`${endCurrency}`];
							let USDToGBPValue = USDToGBPRate * Number(moneyValue);
							document.getElementById('Converted').innerHTML = `The converted amount is: ${USDToGBPValue.toFixed(2)} ${endCurrency}`;
						};
					};
				};
			};
		</script>
	</head>
	<body>
		<h2>Convert your currency with the latest exchanges rates!</h2>
		<form name="converter" action="/convert" method="POST">
			Select your base currency: 
			<select name="base">
				<option value="USD">USD</option>
				<option value="GBP">GBP</option>
				<option value="CAD">CAD</option>
			</select><br>
			Select your end currency: 
			<select name="end">
				<option value="USD">USD</option>
				<option value="GBP">GBP</option>
				<option value="CAD">CAD</option>
			</select><br>
			Enter your base amount here: <input type="text" name="value" />
			<button type="button" id="Convert" onclick="fun()"/> Convert!</button>
			<p id="Converted"></p>
		</form>
	</body>
</html>
